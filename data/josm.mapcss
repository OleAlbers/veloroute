meta {
  title: "Veloroute.Hamburg v2";
}

canvas {
  default-points: false;
  fill-color: #efe9e1;
}

node|z16-[type!=mapillary-sequence] {
  symbol-size:2;
  symbol-shape: square;
  symbol-stroke-color: #333;
  symbol-fill-color: #ccc;
}

node[type=marker] {
  symbol-size: 17;
  symbol-shape: square;
  color: #ff00ee;
  font-size: 10;

  text-halo-radius: 1;

  symbol-stroke-color: #fff;
  symbol-fill-color: eval(tag("color"));
  text: name;
  text-offset-x: -1;
  text-anchor-horizontal: center;
  text-anchor-vertical: center;
}

way node[type=marker] {
  symbol-shape: circle;
}


way {
  color: #ff00ee;
  width: 3;
  casing-width: 1;
  casing-color: white;
  opacity: 1;
  text-halo-radius: 1;
}

way|z0- {
  font-size: 0;
}

way|z15- {
  font-size: 8;
}

way|z17- {
  font-size: 12;
  font-weight: bold;
}

relation >[role="forward"] way|z15-::oneway {
  modifier: true;
  offset: 0 - prop("width", "default");
  width: prop("width", "default")/2;
  dashes: 15,15;
}

relation >[role="backward"] way|z15-::oneway {
  modifier: true;
  offset: prop("width", "default");
  width: prop("width", "default")/2;
}

/* error highlight nodes with only some of the tags */
node[seq_forward_start], node[img_forward_start], node[seq_backward_start], node[img_backward_start] {
  set error;
}

/* highlight if mapillary ref is wrong */
node[eval(length(tag("seq_forward_start")) != 22)], node[eval(length(tag("img_forward_start")) != 22)], node[eval(length(tag("img_forward_end")) != 22)], node[eval(length(tag("seq_backward_start")) != 22)], node[eval(length(tag("img_backward_start")) != 22)], node[eval(length(tag("img_backward_end")) != 22)] {
  set error;
}

node.error {
  symbol-size: 12;
  symbol-shape: square;
  symbol-stroke-color: #ff00ee;
  symbol-fill-color: #ff00ee;
}

/* hide error highlight if matching tags
  1. nodes in the middle somewhere
  2. node starting somewhere
  3. node ending somewhere
*/
node[seq_forward_start][img_forward_start][img_forward_end][seq_backward_start][img_backward_start][img_backward_end]:connection,
node[seq_forward_start][img_forward_start][!img_forward_end][!seq_backward_start][!img_backward_start][img_backward_end]!:connection,
node[!seq_forward_start][!img_forward_start][img_forward_end][seq_backward_start][img_backward_start][!img_backward_end]!:connection
 {
  symbol-size: 8;
  symbol-shape: square;
  symbol-stroke-color: #333;
  symbol-fill-color: #ccc;
  set nodeOk;
}

node[seq_forward_start][img_forward_start][img_forward_end][seq_backward_start][img_backward_start][img_backward_end]:connection < way,
node[seq_forward_start][img_forward_start][!img_forward_end][!seq_backward_start][!img_backward_start][img_backward_end]!:connection < way,
node[!seq_forward_start][!img_forward_start][img_forward_end][seq_backward_start][img_backward_start][!img_backward_end]!:connection < way {
  set parentColor;
}

way.hasForward.hasBackward[color] {
  color: eval(tag("color"));
}

way.parentColor::default, way.parentColor::oneway {
  color: eval(
    count(parent_tags("color")) <= 2 && count(parent_tags("color")) > 0
      ? get(parent_tags("color"), 0)
      : #ff00ee
    );
  dashes: eval(
    count(parent_tags("color")) == 2
      ? list(10, 10)
      : none
    );
  dashes-background-color: get(parent_tags("color"), 1);
}

way[img_date] {
  text: concat(prop(text), eval(tag("img_date")));
}

way[type=mapillary-sequence] {
  color: #00cc63;
  width: 1;
  text: "";
  casing-width: 0;
  opacity: 0.2;
}

way[type=mapillary-sequence] > node|z18- {
  /*
  SVGSalamader doesn't parse this SVG for some reason and doesn't give a decent error message
  icon-image: "data:image/svg+xml,<svg><path d='m -16.745552,-26.259853 a 83.120819,84.457169 0 0 1 -83.120815,-2e-6 l 41.560409,-73.142054 z' transform='rotate(-180 -8 -7)' fill='#00cc63'/></svg>";
  */
  /* same image as png */
  icon-image: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFMAAABUCAYAAAD+twu4AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABtNJREFUeJztnVlsVGUUx3/nDq0sKkaNCRpMNPHB1ABppwQraur+og8affDBRKcaE2MEtCKbAoriSgwK2HY6tWqM1miiMe57gAjFHYkLoojiCtJBSqede3wYkOEy7dy5+235vUw69/vOOf1n0vuf833frRAGn994Av25GpSJiEwAJoBMAD0ROA44Ahi773UMMBrYC/QWvfYBf4P8Crod2I7qdjC2kshvpDbzZ9C/lvga/fkrE5x65GQkcSbKGQino3oGBcH85i9ENqJsAv0SZS1ber7gqq68Xwm9FfO7m4+gp/csVKcD04FpwFGe5nBHFlgLrAb9iPHj1nDa8j6vgrsXc03qWKo5H+FSlMuA8e7LCow9oO8ixivkB15masdvboI5E3NN6liquBrhKqABSLgpIiLkUVYjPEd19bNMWrmz0gD2xdSFBt1bz8OQa1CuoHCDGK70gb4F0kl24ks0LhywM6m8mN03HI8M3IQa14Oe5LrM+LENaIXECpItfw01cHAxP246hYQ5A6SJ4f0ptEsfwvOYuoT69m9KDThUzHXXT8HIzwO5HDD8rjCG5IEXMXQJte2fF184IOa6ayciMh+RFMPjhuI3CrwAiTkkWzYDyD5rcztwC4VvGoepjH5UM+SNO0dRzasUzPVhnFGFyA2M0kkGKneHXc2wQHVx4W/m+tRrCJeEXE58EXmburYLC3drQ2YB/eFWFFsGMHUm7Lc+dW2bEJ4ItaTYIiupT38FxT6yqvpO4O+wSoopO8FYvP+HA2JOWrkT0XtCKSm+LCr+innwN5yekx8DNgZdUUz5BhIrit84WMzGhQOIcUegJcWXW0m2HHTTLt3o6L7udZCLAykpjijvUJ++wPp26UaGGDMBWz28EUgeyc8sdaG0mHVtm4AWPyuKLaqrSHZ8WerS4C22HAuAHX7VFFP+QUYtHOzi4GI2pHegHLZKxYguGqrbPnTzVxKPASW7yiOQ7xmdXTHUgKHFTLb0IzR7WlJcEWMmNV25IYfYCjTirZK+S7L9/HKj7K3xGDqLkWuV8mDOsDPQnpi1ma+BVjcVxZgnBrNCVuyvPuaYz8izSv9A4i67g+2L2ZDeAXKvo5Jii95dbuNBMZWti4/ZtRz4ttKSYspmxo97vJIJlYlZ05VD5faK5sQV1VmVbjd0tguuO/UGcJGjubHAnhWy4mz7i2EO565Sfl/XrGKciVmb+Roh7Whu5JFW6tq+cDLT+cYsMRcAuxzPjyZZzIFFTic7F7M28yeiSxzPjyaL3WzFdrdlcHT2UeA7VzGiww+MH7vcTQB3YtZ05RCd7SpGdLjV7ckLb46udKfeBC70JFY4vEcyfZ7bIN7sDDa0mcKO2jhiIuJJz9YbMQvbkds9iRU0qm3UtW3wIpR3e9arquYTP6uURU3bXaFyeCfm5FV/APd5Fi8IlHvcnkorxtvTFGN6lhEfq/QDx4x91MuA3opZ05VDdY6nMf1CpNnLQ6jg1xHpDU1voXrIXpwI8T7JdKPXQf05NCXmbUTXKpmI3OZHYH/ELFiljC+x3ZP2ygpZ8e84X1XVPKJnlbKVLJBVin9iTl71B8hS3+I7YwnJlu1+Bff3oOmYXY8A3/uawz5byOY9tUJW/BWzsAAXDauk2kxjx14/U/j79Jj9bGh6H9VzA8lVmtXUpc9GUD+TBHOePC8zADOQXIdiYugMv4WEoMSc2voZQkcguQ5BMtS2dweRKbgnHfTLXKAnsHwFdoOxIKhkwYk5re13RO8PLF+Be/20QlaCfQbH0eMeBjYHlG0L2fyygHIBQYt52vI+ROcGlG2231bISjDWyMr61AcI5/gWX3QNte3Tg7iDFxPWo3b8tEom+UQgVshKOGLWpz8FOn2JrfokU1vX+xK7DOE9BGpA7sB7q7SbBPM9jmmb8MSc1vY78KCnMVWWUtv+q6cxKyDcx5Nl8w8BP3oU7WfECNQKWQlXzMaOvSjedJVEmkm27PEkltMSwkz+P92pD4GzHc9X1pJMnxXGHbyYiDyF0HRjlRQIxQpZiYaYycwnIE87nN1JfXqdp/U4JBpiAozKzQV2VzhrD6YZWFeoHNERc0rnLyAPVDjrPqZmfvalHgdER0yA3K6HgJ9sjt4GiUf8LKdSoiVmQ1ev7QU4JXQrZCUa1qgYRdiQ+pDCfyAYbEwkrJCVaH0ygYJA5i0MbpUiY4WsRE9MKFgl4ZnSF+WpqFghK9EUEyDRPwf49+A3pTfIBbJKia6YUzp/QdTSVdKlJFu2hlNQeaIrJkBf9gEOWKVtVOUeDrOcckRbzIauXkTn7ftpNpOf+nfI8YcpgyKsb1qGRtDGWfgPO7DoEmjzH5sAAAAASUVORK5CYII=";
  icon-width: 11;
  icon-height: 11;
  icon-opacity: 0.4;
  icon-rotation: degree_to_radians(tag(bearing));
  color: #ff00ee;
  font-size: 10;
}

way[type=mapillary-sequence] > node|z18- {
  icon-width: 15;
  icon-height: 15;
}

way[type=mapillary-sequence] > node|z19- {
  icon-width: 20;
  icon-height: 20;
}


way[type=detour] {
  color: #f0ca00;
  width: 4;
  text: "";
  casing-width: 0;
  dashes: 2;
}


area[type=article] {
  fill-color: #000;
  fill-opacity: 0.2;
  color: #888;
  width: 1;
  casing-width: 0;
  text: prop(name);
}
